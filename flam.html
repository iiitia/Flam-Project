<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bézier Curve Physics Interaction</title>

    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #141426;
            font-family: "Segoe UI", system-ui, sans-serif;
            color: #e6e6ff;
            overflow: hidden;
        }

        canvas {
            display: block;
            margin: 0 auto;
            background: #0b0b18;
            border: 2px solid #1f2a44;
            border-radius: 10px;
            box-shadow: 0 4px 18px rgba(0,0,0,0.5);
            cursor: crosshair;
        }

        .info, .controls {
            text-align: center;
            margin-top: 15px;
        }

        .controls {
            margin-top: 8px;
        }

        .group {
            display: inline-block;
            margin: 0 12px;
        }

        .group label {
            display: block;
            font-size: 13px;
            margin-bottom: 6px;
        }

        input[type="range"] {
            width: 150px;
        }

        .value {
            color: #5cd3ff;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <canvas id="view"></canvas>

    <div class="info">
        Move your mouse around — the curve reacts with spring dynamics.
    </div>

    <div class="controls">
        <div class="group">
            <label>Spring Strength: <span id="stVal" class="value">0.05</span></label>
            <input type="range" id="stiffnessUI" min="0.01" max="0.20" step="0.01" value="0.05">
        </div>
        <div class="group">
            <label>Damping: <span id="dampVal" class="value">0.30</span></label>
            <input type="range" id="dampUI" min="0.1" max="0.9" step="0.05" value="0.3">
        </div>
        <div class="group">
            <label>Tangents: <span id="tanVal" class="value">8</span></label>
            <input type="range" id="tangentUI" min="3" max="20" step="1" value="8">
        </div>
    </div>

<script>

  // Canvas and Rendering Setup //
 
const canvas = document.getElementById("view");
const ctx = canvas.getContext("2d");

canvas.width  = Math.min(1200, window.innerWidth - 40);
canvas.height = Math.min(700,  window.innerHeight - 140);

let WIDTH  = canvas.width;
let HEIGHT = canvas.height;


  // Physics Parameters //
 
let STIFFNESS = 0.05;
let DAMPING   = 0.30;
let TANGENTS  = 8;


   // Control Point (Spring) Object //
  
class SpringPoint {
    constructor(x, y, locked=false) {
        this.x = x;
        this.y = y;
        this.vx = 0;
        this.vy = 0;
        this.targetX = x;
        this.targetY = y;
        this.locked = locked;
    }

    aim(x, y) {
        this.targetX = x;
        this.targetY = y;
    }

    update() {
        if (this.locked) return;

        let dx = this.targetX - this.x;
        let dy = this.targetY - this.y;

        // acceleration formula with spring + damping
        let ax = dx * STIFFNESS - this.vx * DAMPING;
        let ay = dy * STIFFNESS - this.vy * DAMPING;

        this.vx += ax;
        this.vy += ay;

        this.x += this.vx;
        this.y += this.vy;
    }
}


 //  Initialize Bézier Control Points //
  
let pA = new SpringPoint(WIDTH * 0.15, HEIGHT * 0.50, true);
let pB = new SpringPoint(WIDTH * 0.35, HEIGHT * 0.28);
let pC = new SpringPoint(WIDTH * 0.65, HEIGHT * 0.72);
let pD = new SpringPoint(WIDTH * 0.85, HEIGHT * 0.50, true);

let cps = [pA, pB, pC, pD];

 // Bézier Curve Functions //
  
// Position on curve
function bezierPoint(t, P0, P1, P2, P3) {
    const u = 1 - t;
    return {
        x:
            u*u*u * P0.x +
            3*u*u*t * P1.x +
            3*u*t*t * P2.x +
            t*t*t * P3.x,
        y:
            u*u*u * P0.y +
            3*u*u*t * P1.y +
            3*u*t*t * P2.y +
            t*t*t * P3.y
    };
}

// Derivative at t
function bezierDerivative(t, P0, P1, P2, P3) {
    const u = 1 - t;
    return {
        x: 3*u*u*(P1.x-P0.x) + 6*u*t*(P2.x-P1.x) + 3*t*t*(P3.x-P2.x),
        y: 3*u*u*(P1.y-P0.y) + 6*u*t*(P2.y-P1.y) + 3*t*t*(P3.y-P2.y)
    };
}

function unitVector(v) {
    let m = Math.hypot(v.x, v.y);
    return m === 0 ? {x:0,y:0} : {x:v.x/m, y:v.y/m};
}


    //Interaction: Mouse influences dynamic points
   
canvas.addEventListener("mousemove", (ev) => {
    let r = canvas.getBoundingClientRect();
    let mx = ev.clientX - r.left;
    let my = ev.clientY - r.top;

    // P1 moves toward mouse with bias
    pB.aim(mx * 0.55 + WIDTH * 0.18,
           my * 0.60 + HEIGHT * 0.12);

    // P2 reacts inversely for rope-like effect
    pC.aim(WIDTH - mx * 0.55 + WIDTH * 0.12,
           HEIGHT - my * 0.60 + HEIGHT * 0.08);
});


  // UI Controls//
 
document.getElementById("stiffnessUI").addEventListener("input", e => {
    STIFFNESS = parseFloat(e.target.value);
    document.getElementById("stVal").textContent = STIFFNESS.toFixed(2);
});

document.getElementById("dampUI").addEventListener("input", e => {
    DAMPING = parseFloat(e.target.value);
    document.getElementById("dampVal").textContent = DAMPING.toFixed(2);
});

document.getElementById("tangentUI").addEventListener("input", e => {
    TANGENTS = parseInt(e.target.value);
    document.getElementById("tanVal").textContent = TANGENTS;
});


  // Rendering the Scene //
 
function drawScene() {
    ctx.fillStyle = "#0b0b18";
    ctx.fillRect(0, 0, WIDTH, HEIGHT);

    // draw connecting lines
    ctx.setLineDash([6, 5]);
    ctx.strokeStyle = "rgba(150,150,200,0.3)";
    ctx.beginPath();
    ctx.moveTo(pA.x, pA.y);
    ctx.lineTo(pB.x, pB.y);
    ctx.lineTo(pC.x, pC.y);
    ctx.lineTo(pD.x, pD.y);
    ctx.stroke();
    ctx.setLineDash([]);

    // draw curve
    ctx.lineWidth = 3;
    ctx.strokeStyle = "#4ecbff";
    ctx.beginPath();
    let first = true;
    for (let t = 0; t <= 1; t += 0.01) {
        let pt = bezierPoint(t, pA, pB, pC, pD);
        if (first) { ctx.moveTo(pt.x, pt.y); first = false; }
        else       { ctx.lineTo(pt.x, pt.y); }
    }
    ctx.stroke();

    // draw tangents
    ctx.strokeStyle = "#ff2c82";
    let step = 1 / (TANGENTS + 1);
    for (let i = 1; i <= TANGENTS; i++) {
        let t = i * step;
        let p = bezierPoint(t, pA, pB, pC, pD);
        let d = unitVector(bezierDerivative(t, pA, pB, pC, pD));

        ctx.beginPath();
        ctx.moveTo(p.x, p.y);
        ctx.lineTo(p.x + d.x * 30, p.y + d.y * 30);
        ctx.stroke();

        ctx.beginPath();
        ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
        ctx.fillStyle = "#ff2c82";
        ctx.fill();
    }

    // draw points
    cps.forEach((p, i) => {
        ctx.fillStyle = p.locked ? "#822ade" : "#3e8bff";
        ctx.beginPath();
        ctx.arc(p.x, p.y, 8, 0, Math.PI * 2);
        ctx.fill();

        ctx.strokeStyle = "#fff";
        ctx.lineWidth = 2;
        ctx.stroke();

        ctx.font = "12px monospace";
        ctx.fillStyle = "#fff";
        ctx.fillText("P" + i, p.x - 6, p.y - 14);
    });
}

 //  Animation Loop //

function loop() {
    cps.forEach(p => p.update());
    drawScene();
    requestAnimationFrame(loop);
}

loop();

</script>
</body>
</html>
